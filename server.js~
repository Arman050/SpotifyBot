const puppeteer = require('puppeteer');

const SPOTIFY_URL = 'https://partner-provisioning.spotify.com/starbucks/';
const SPOTIFY_LOGIN_URL = 'https://accounts.spotify.com/en/login';
const SPOTIFY_REGISTER_URL = 'https://partner-provisioning.spotify.com/starbucks/register/';

const usernames = ['US8547584', 'US8547585']; // Remplacez par vos noms d'utilisateur Starbucks
const lastName = 'Smith'; // Remplacez par votre nom de famille

const emails = [
    // MINE

    'tstpu7768735@aol.com',
    'ritrumoyda@gufum.com',
    'irrrw4237454@aol.com',

    // TR SERVICES 11/10/24
    'gtc1478gtc13@gmail.com',
    'gtc1478gtc14@gmail.com',
    'gtc1478gtc15@gmail.com',
    'gtc1478gtc16@gmail.com',
    'gtc1478gtc17@gmail.com',
    // 'gtc1478gtc18@gmail.com', // PASSWORD OR MAIL INCORRECT
    'gtc1478gtc111@gmail.com',
    'jjnho3726019@aol.com',
    'fyhni7189343@aol.com',
    'nmxjn1944625@aol.com',
    'qvxeb5282953@aol.com',
    'ntich6000002@aol.com',
    'fvjxz9564537@aol.com',
    'jxykl9930802@aol.com',
    'vccug4689728@aol.com',
    'vrwbo6580802@aol.com',
    'lklqs4067385@aol.com',
    'yduwz1484629@aol.com',
    'ixano3633534@aol.com',
    'goqsk5079158@aol.com',
    'pbcgy4900586@aol.com',
    'waaeg1066643@aol.com',
    'dwqih5854058@aol.com',
    'rljqg6700854@aol.com',
    'qlmnu4015827@aol.com',
    'lsjvd7435555@aol.com',
    'khqnv9055479@aol.com',
    'uijhu8068949@aol.com',
    // 'qbkrx2764066@aol.com', // MAIL OR PASS INCORRECT
    'aycud3844250@aol.com',
    'tsucn3745144@aol.com',
    'mnqjq9089737@aol.com',
    'xbodo4796448@aol.com',
    'vnfzq6125123@aol.com',
    'ddkxh9876616@aol.com',
    'ptkhj6545639@aol.com',
    // 'vecjs1071017@aol.com', // PASS INCORRECT
    // 'sijrn8715505@aol.com', // PASS INCORRECT
    'rlxzo0338750@aol.com',
    'wljmk2968286@aol.com',
    'nugtn0539422@aol.com',
    'dscpl7958151@aol.com',
    'eydro7696120@aol.com',
    'mxzuy6886890@aol.com',
    'qywqp3678472@aol.com',
    'fhigo3764762@aol.com',
    'pgnjy6261762@aol.com',
    'yvyxk3793717@aol.com',
    'lmfkb0079254@aol.com',
    'mwjec9256453@aol.com',
    'endru5430554@aol.com',
    'gdkhj6224979@aol.com',
    'ifbjd0812432@aol.com',
    'xevgl1722454@aol.com',
    'hsutw7786141@aol.com',
    'jaffo8685487@aol.com',
    'mergn5472325@aol.com',
    'imbyx8707988@aol.com',
    'hbdwu7767410@aol.com',
    'tojrl9865250@aol.com',
    'fpgib7511758@aol.com',
    'gnkjm4256441@aol.com',
    'owmpj4151653@aol.com',
    'xqwjj0243423@aol.com',
    'phbag8640929@aol.com',
    'dambx0691090@aol.com',
    'frzhs6064610@aol.com',
    'uemcy5977781@aol.com',
    'sznnu7385914@aol.com',
    'yssah8819139@aol.com',
    'zwqhm5600131@aol.com',
    'zygcy1481807@aol.com',
    'crgid0302842@aol.com',
    'xkgez9403421@aol.com',
    'knvbx7229201@aol.com',
    'qjdtz5413290@aol.com',
    'fwnlo8934021@aol.com',
    'mergn5472325@aol.com',
    'gsgmv1833558@aol.com',
    'zydte1783200@aol.com',
    'ngdoe2699117@aol.com',
    'hpzmn6293142@aol.com',
    'bzfsg2927062@aol.com',
    'oqtxz5583303@aol.com',
    'potbo0359883@aol.com',
    'egjpf8400426@aol.com',
    'cpuwv2437001@aol.com',
    'ihnvd6680118@aol.com',
    'llaoe2703890@aol.com',
    'uqvpl7538773@aol.com',
    'cohpk5343502@aol.com',
    'ancpy9902777@aol.com',
    'lyrmm6494738@aol.com',
    'wxlwc3660504@aol.com',
    'pgoqo7716568@aol.com',
    'alsnfu2973@gmail.com',
    'asbckzpl16@gmail.com',
    'asbckzpl17@gmail.com',
    'asbckzpl18@gmail.com',
    'asbckzpl19@gmail.com',
    'seiufhs251@gmail.com',
    'seiufhs252@gmail.com',
    'seiufhs253@gmail.com',
    'seiufhs255@gmail.com',
    'seiufhs256@gmail.com',
    'zpjheifou258@gmail.com',
    'zpjheifou260@gmail.com',
    'zpjheifou261@gmail.com',
    'zpjheifou262@gmail.com',
    'zpjheifou263@gmail.com',
    'zddq145z@gmail.com',
    'qgefuoj5151@gmail.com',

        // TR SERVICES 13 / 10 / 24
        'zxcvbnmyyyu@gmail.com',
        'aqwxcv85zzd@gmail.com',
        'oahuh56zd@gmail.com',
        'qizofj154z@gmail.com',
        'p3r1x74@gmail.com',
        'l33nnon@gmail.com',
        'alsajd254aq@gmail.com',
        'hqpozkd15z@gmail.com',
        'okjhgf52ze@gmail.com',
        'iuhnd85zfe@gmail.com',
        'izhfuls52ej@gmail.com',
        'okjznf51zd@gmail.com',
        '854dsdz4@gmail.com',
        '21sdg65s@gmail.com',
        'qodjqoizj45q1@gmail.com',
        '9876543210y@gmail.com',
        'hjkllkj9876@gmail.com',
        'cvbnm12345y@gmail.com',
        'poiuyt56789@gmail.com',
        'asdfghjklzy@gmail.com',
        'qwertyuiopyyy@gmail.com',
        'asdfghjklyyyu@gmail.com',
        '12345678dqd0@gmail.com',
        'qwertyuiopyuy@gmail.com',
        'sjkbvk26xdvb@gmail.com',
        'zd585dzc@gmail.com',
        '5z4d45zd@gmail.com',
        '84ef8s4fs8@gmail.com',
        '4qz8d4q55@gmail.com',
        'qaqigund12345@gmail.com',
        'grxv124@mail.ru',
        'lqp94j@mail.ru',
        '5nhty@mail.ru',
        'rexa.pl87@mail.ru',
        'bxpnt237@mail.ru',
        'qrt19z@mail.ru',
        'zok63df@mail.ru',
        'ykf.pl4z@mail.ru',
        'wxr829ty@mail.ru',
        'jnv9k3s@mail.ru',
        'vpqyr77@mail.ru',
        'gzrt05@mail.ru',
        'lxwt83v@mail.ru',
        '3rfwxn@mail.ru',
        'nsx7fr2@mail.ru',
        'tqn48kp@mail.ru',
        'vpxz31@mail.ru',
        'wlgx0n@mail.ru',
        'btrgk57@mail.ru',
        'xrv8pt@mail.ru',
        'kpt47yn@mail.ru',
        'flxg92@mail.ru',
        'dnplx5@mail.ru',
        '94htpl@mail.ru',
        'tzq80wp@mail.ru',
        'ztlwrm21@mail.ru',
        'knvpx78@mail.ru',
        'pzxl03g@mail.ru',
        'bqx49lr@mail.ru',
        'gntzr5@mail.ru'

];




const password = 'SPOTIFY12345'; // Remplacez par votre mot de passe

(async () => {
    for (let i = 0; i < emails.length; i++) {
        const email = emails[i];
        const username = usernames[i % usernames.length]; // Gère le cas où le nombre d'e-mails est supérieur au nombre d'utilisateurs

        const browser = await puppeteer.launch({ headless: true }); // Lancer le navigateur en mode headless
        const page = await browser.newPage();

        try {
            // Étape 1 : Accéder à la page d'offre de Spotify
            console.log(`Navigating to ${SPOTIFY_URL} for ${email}...`);
            await page.goto(SPOTIFY_URL, { waitUntil: 'networkidle0' });

            // await page.waitForSelector('#authorize-btn', { visible: true });
            await page.click('#authorize-btn');

            // Étape 2 : Attendre la redirection vers la page de connexion Spotify
            await page.waitForNavigation({ waitUntil: 'networkidle0' });
            console.log(`Navigating to ${SPOTIFY_LOGIN_URL}...`);
            // await page.goto(SPOTIFY_LOGIN_URL);

            // Étape 3 : Se connecter à Spotify
            console.log(`Logging in with email: ${email}...`);
            await page.type('#login-username', email);
            await page.type('#login-password', password);
            await page.click('#login-button');

            // Attendre que la connexion soit réussie et que la redirection se produise
            await page.waitForNavigation({ waitUntil: 'networkidle0' });

            // Vérifiez si vous êtes redirigé vers la page d'offre
            let isOnOfferPage = true;
            let attempts = 0;

            while (isOnOfferPage && attempts < 5) {
                const currentUrl = page.url();

                if (currentUrl.includes('accounts.spotify.com/en/status')) {
                    console.log('Redirected to status page, navigating to registration page.');
                    await page.goto(SPOTIFY_REGISTER_URL, { waitUntil: 'networkidle0' });
                    attempts++;
                } else if (currentUrl === SPOTIFY_URL) {
                    console.log('Back on offer page, clicking authorize button again.');
                    await page.click('#authorize-btn');
                    await page.waitForNavigation({ waitUntil: 'networkidle0' });
                    attempts++;
                } else {
                    isOnOfferPage = false; // Sortir de la boucle si on n'est pas sur la page d'offre
                }
            }

            // Étape 4 : Accéder à la page de liaison du compte
            await page.waitForSelector('#last-name', { visible: true });
            await page.waitForSelector('#global-user-name', { visible: true });
            await page.waitForSelector('input[type="checkbox"]', { visible: true });
            await page.waitForSelector('button[type="submit"]', { visible: true });

            await page.type('#last-name', lastName);
            await page.type('#global-user-name', username);
            await page.click('input[type="checkbox"]');
            await page.click('button[type="submit"]');

            // Attendre 2 secondes pour voir les résultats
            await new Promise(resolve => setTimeout(resolve, 2000)); // Remplacer par waitForTimeout

            console.log(`Bot a terminé les étapes pour ${email}.`);
        } catch (error) {
            console.error(`Erreur pour ${email}: ${error.message}`);
        } finally {
            await browser.close(); // Fermez le navigateur après chaque compte
        }
    }
})();



//
//
// const puppeteer = require('puppeteer');
//
// const SPOTIFY_URL = 'https://partner-provisioning.spotify.com/starbucks/';
// const SPOTIFY_LOGIN_URL = 'https://accounts.spotify.com/en/login';
// const SPOTIFY_REGISTER_URL = 'https://partner-provisioning.spotify.com/starbucks/register/';
//
// const usernames = ['US8547584', 'US8547585']; // Remplacez par vos noms d'utilisateur Starbucks
// const lastName = 'Smith'; // Remplacez par votre nom de famille
//
//
// const emails = [
//     'qaqigund12345@gmail.com',
//     'grxv124@mail.ru',
//     'lqp94j@mail.ru',
//     '5nhty@mail.ru',
//     'rexa.pl87@mail.ru',
//     'bxpnt237@mail.ru',
//     'qrt19z@mail.ru',
//     'zok63df@mail.ru',
//     'ykf.pl4z@mail.ru',
//     'wxr829ty@mail.ru',
//     'jnv9k3s@mail.ru',
//     'vpqyr77@mail.ru',
//     'gzrt05@mail.ru',
//     'lxwt83v@mail.ru',
//     '3rfwxn@mail.ru',
//     'nsx7fr2@mail.ru',
//     'tqn48kp@mail.ru',
//     'vpxz31@mail.ru',
//     'wlgx0n@mail.ru',
//     'btrgk57@mail.ru',
//     'xrv8pt@mail.ru',
//     'kpt47yn@mail.ru',
//     'flxg92@mail.ru',
//     'dnplx5@mail.ru',
//     '94htpl@mail.ru',
//     'tzq80wp@mail.ru',
//     'ztlwrm21@mail.ru',
//     'knvpx78@mail.ru',
//     'pzxl03g@mail.ru',
//     'bqx49lr@mail.ru',
//     'gntzr5@mail.ru'
// ];
//
//
//
//
// const password = 'SPOTIFY12345'; // Remplacez par votre mot de passe
//
// (async () => {
//     for (let i = 0; i < emails.length; i++) {
//         const email = emails[i];
//         const username = usernames[i % usernames.length]; // Gère le cas où le nombre d'e-mails est supérieur au nombre d'utilisateurs
//
//         const browser = await puppeteer.launch({ headless: false }); // Lancer le navigateur en mode headless
//         const page = await browser.newPage();
//
//         try {
//             // Étape 1 : Accéder à la page d'offre de Spotify
//             console.log(`Navigating to ${SPOTIFY_URL} for ${email}...`);
//             await page.goto(SPOTIFY_URL, { waitUntil: 'networkidle0' });
//
//             // await page.waitForSelector('#authorize-btn', { visible: true });
//             await page.click('#authorize-btn');
//
//             // Étape 2 : Attendre la redirection vers la page de connexion Spotify
//             await page.waitForNavigation({ waitUntil: 'networkidle0' });
//             console.log(`Navigating to ${SPOTIFY_LOGIN_URL}...`);
//             // await page.goto(SPOTIFY_LOGIN_URL);
//
//             // Étape 3 : Se connecter à Spotify
//             console.log(`Logging in with email: ${email}...`);
//             await page.type('#login-username', email);
//             await page.type('#login-password', password);
//             await page.click('#login-button');
//
//             // Attendre que la connexion soit réussie et que la redirection se produise
//             await page.waitForNavigation({ waitUntil: 'networkidle0' });
//
//             // Vérifiez si vous êtes redirigé vers la page d'offre
//             let isOnOfferPage = true;
//             let attempts = 0;
//
//             while (isOnOfferPage && attempts < 5) {
//                 const currentUrl = page.url();
//
//                 if (currentUrl.includes('accounts.spotify.com/en/status')) {
//                     console.log('Redirected to status page, navigating to registration page.');
//                     await page.goto(SPOTIFY_REGISTER_URL, { waitUntil: 'networkidle0' });
//                     attempts++;
//                 } else if (currentUrl === SPOTIFY_URL) {
//                     console.log('Back on offer page, clicking authorize button again.');
//                     await page.click('#authorize-btn');
//                     await page.waitForNavigation({ waitUntil: 'networkidle0' });
//                     attempts++;
//                 } else {
//                     isOnOfferPage = false; // Sortir de la boucle si on n'est pas sur la page d'offre
//                 }
//             }
//
//             // Étape 4 : Accéder à la page de liaison du compte
//             await page.waitForSelector('#last-name', { visible: true });
//             await page.waitForSelector('#global-user-name', { visible: true });
//             await page.waitForSelector('input[type="checkbox"]', { visible: true });
//             await page.waitForSelector('button[type="submit"]', { visible: true });
//
//             await page.type('#last-name', lastName);
//             await page.type('#global-user-name', username);
//             await page.click('input[type="checkbox"]');
//             await page.click('button[type="submit"]');
//
//             // Attendre 2 secondes pour voir les résultats
//             await new Promise(resolve => setTimeout(resolve, 2000)); // Remplacer par waitForTimeout
//
//             console.log(`Bot a terminé les étapes pour ${email}.`);
//         } catch (error) {
//             console.error(`Erreur pour ${email}: ${error.message}`);
//         } finally {
//             await browser.close(); // Fermez le navigateur après chaque compte
//         }
//     }
// })();
